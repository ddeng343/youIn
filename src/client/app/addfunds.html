<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>title</title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />

    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  </head>
  <body class="addfunds">
    <div class="panel panel-default bootstrap-basic">
      <div class="panel-heading">
        <h3 class="panel-title">Enter Card Details</h3>
      </div>
      <form class="panel-body">
        <div class="row">
          <div class="form-group col-xs-8">
            <label class="control-label">Card Number</label>
            <div class="form-control" id="card-number"></div>
            <span class="helper-text"></span>
          </div>
          <div class="form-group col-xs-4">
            <div class="row">
              <label class="control-label col-xs-12">Expiration Date</label>
              <div class="col-xs-6">
                <div class="form-control" id="expiration-month"></div>
              </div>
              <div class="col-xs-6">
                <div class="form-control" id="expiration-year"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-xs-6">
            <label class="control-label">Security Code</label>
            <div class="form-control" id="cvv"></div>
          </div>
          <div class="form-group col-xs-6">
            <label class="control-label">Zipcode</label>
            <div class="form-control" id="postal-code"></div>
          </div>
        </div>


        <button value="submit" id="submit" class="btn btn-success btn-lg center-block">Donate $5</button>
      </form>

    <!-- Load the required client component. -->
    <script src="https://js.braintreegateway.com/web/3.11.1/js/client.min.js"></script>

    <!-- Load Hosted Fields component. -->
    <script src="https://js.braintreegateway.com/web/3.11.1/js/hosted-fields.min.js"></script>
    <script>
    // We generated a client token for you so you can test out this code
    // immediately. In a production-ready integration, you will need to
    // generate a client token on your server (see section below).
    var authorization = 'eyJ2ZXJzaW9uIjoyLCJhdXRob3JpemF0aW9uRmluZ2VycHJpbnQiOiI2NDQ2NjczYzdhN2VkZjIxOGIxNDczZDY5NjRhNmM4MWQ1MzJlNGUwZGRjNjUzNDNiODYxZjNkOTk1ODg5YjUzfGNyZWF0ZWRfYXQ9MjAxNy0wMy0yOVQxOTowNTowMS4zNzcxNTY1MzgrMDAwMFx1MDAyNm1lcmNoYW50X2lkPTZzeGI2d2NqODlqbXo1ZjlcdTAwMjZwdWJsaWNfa2V5PTQ0bTJyNzhqOHFwM3NkbWsiLCJjb25maWdVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvNnN4YjZ3Y2o4OWptejVmOS9jbGllbnRfYXBpL3YxL2NvbmZpZ3VyYXRpb24iLCJjaGFsbGVuZ2VzIjpbXSwiZW52aXJvbm1lbnQiOiJzYW5kYm94IiwiY2xpZW50QXBpVXJsIjoiaHR0cHM6Ly9hcGkuc2FuZGJveC5icmFpbnRyZWVnYXRld2F5LmNvbTo0NDMvbWVyY2hhbnRzLzZzeGI2d2NqODlqbXo1ZjkvY2xpZW50X2FwaSIsImFzc2V0c1VybCI6Imh0dHBzOi8vYXNzZXRzLmJyYWludHJlZWdhdGV3YXkuY29tIiwiYXV0aFVybCI6Imh0dHBzOi8vYXV0aC52ZW5tby5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tIiwiYW5hbHl0aWNzIjp7InVybCI6Imh0dHBzOi8vY2xpZW50LWFuYWx5dGljcy5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tLzZzeGI2d2NqODlqbXo1ZjkifSwidGhyZWVEU2VjdXJlRW5hYmxlZCI6dHJ1ZSwicGF5cGFsRW5hYmxlZCI6dHJ1ZSwicGF5cGFsIjp7ImRpc3BsYXlOYW1lIjoiSGFjayBSZWFjdG9yIiwiY2xpZW50SWQiOm51bGwsInByaXZhY3lVcmwiOiJodHRwOi8vZXhhbXBsZS5jb20vcHAiLCJ1c2VyQWdyZWVtZW50VXJsIjoiaHR0cDovL2V4YW1wbGUuY29tL3RvcyIsImJhc2VVcmwiOiJodHRwczovL2Fzc2V0cy5icmFpbnRyZWVnYXRld2F5LmNvbSIsImFzc2V0c1VybCI6Imh0dHBzOi8vY2hlY2tvdXQucGF5cGFsLmNvbSIsImRpcmVjdEJhc2VVcmwiOm51bGwsImFsbG93SHR0cCI6dHJ1ZSwiZW52aXJvbm1lbnROb05ldHdvcmsiOnRydWUsImVudmlyb25tZW50Ijoib2ZmbGluZSIsInVudmV0dGVkTWVyY2hhbnQiOmZhbHNlLCJicmFpbnRyZWVDbGllbnRJZCI6Im1hc3RlcmNsaWVudDMiLCJiaWxsaW5nQWdyZWVtZW50c0VuYWJsZWQiOnRydWUsIm1lcmNoYW50QWNjb3VudElkIjoiaGFja3JlYWN0b3IiLCJjdXJyZW5jeUlzb0NvZGUiOiJVU0QifSwiY29pbmJhc2VFbmFibGVkIjpmYWxzZSwibWVyY2hhbnRJZCI6IjZzeGI2d2NqODlqbXo1ZjkiLCJ2ZW5tbyI6Im9mZiJ9';
    braintree.client.create({
      authorization: authorization
    }, function (err, clientInstance) {
      if (err) {
        console.error(err);
        return;
      }

      braintree.hostedFields.create({
        client: clientInstance,
        styles: {
          'input': {
            'font-size': '14px',
            'font-family': 'helvetica, tahoma, calibri, sans-serif',
            'color': '#3a3a3a'
          },
          ':focus': {
            'color': 'black'
          }
        },
        fields: {
          number: {
            selector: '#card-number',
            placeholder: '4111 1111 1111 1111'
          },
          cvv: {
            selector: '#cvv',
            placeholder: '123'
          },
          expirationMonth: {
            selector: '#expiration-month',
            placeholder: '10'
          },
          expirationYear: {
            selector: '#expiration-year',
            placeholder: '19'
          },
          postalCode: {
            selector: '#postal-code',
            placeholder: '90210'
          }
        }
      }, function (err, hostedFieldsInstance) {
        if (err) {
          console.error(err);
          return;
        }

        hostedFieldsInstance.on('validityChange', function (event) {
          var field = event.fields[event.emittedBy];

          if (field.isValid) {
            if (event.emittedBy === 'expirationMonth' || event.emittedBy === 'expirationYear') {
              if (!event.fields.expirationMonth.isValid || !event.fields.expirationYear.isValid) {
                return;
              }
            } else if (event.emittedBy === 'number') {
              $('#card-number').next('span').text('');
            }

            // Apply styling for a valid field
            $(field.container).parents('.form-group').addClass('has-success');
          } else if (field.isPotentiallyValid) {
            // Remove styling  from potentially valid fields
            $(field.container).parents('.form-group').removeClass('has-warning');
            $(field.container).parents('.form-group').removeClass('has-success');
            if (event.emittedBy === 'number') {
              $('#card-number').next('span').text('');
            }
          } else {
            // Add styling to invalid fields
            $(field.container).parents('.form-group').addClass('has-warning');
            // Add helper text for an invalid card number
            if (event.emittedBy === 'number') {
              $('#card-number').next('span').text('Looks like this card number has an error.');
            }
          }
        });

        hostedFieldsInstance.on('cardTypeChange', function (event) {
          // Handle a field's change, such as a change in validity or credit card type
          if (event.cards.length === 1) {
            $('#card-type').text(event.cards[0].niceType);
          } else {
            $('#card-type').text('Card');
          }
        });

        $('.panel-body').submit(function (event) {
          event.preventDefault();
          hostedFieldsInstance.tokenize(function (err, payload) {
            if (err) {
              console.error(err);
              return;
            }

            $.ajax({
              url: '/checkout',
              method: 'POST',
              contentType: 'application/json',
              data: JSON.stringify(payload),
              success: function() {
                console.log('success in addFunds.html')
              },
              error: function(err) {
                console.error('error in addFunds.html')
              }
            });
          });
        });
      });
    });
    </script>
  </body>
</html>
